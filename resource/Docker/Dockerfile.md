
---

#docker

*Dockerfile*

---

**Dockerfile**은 [[이미지]]를 직접 만들기 위한 설정 파일이다.

Dockerfile 스크립트에는 토대가 될 이미지나 실행할 명령어 등을 기재한다.

이 파일을 호스트 컴퓨터의 이미지 재료가 들어있는 폴더(위치는 어디라도 상관없다.)에 넣는다.
재료 폴더에는 그 외 컨테이너에 넣을 파일을 함께 둔다. 실제 컨테이너를 만들 필요는 없다.

### 주요 Dockerfile 인스트럭션

| 인스트럭션 | 내용                          |
| ---------- | ----------------------------- |
| FROM       | 토대가 되는 이미지를 지정     |
| ADD        | 이미지에 파일이나 폴더를 추가 |
| COPY       | 이미지에 파일이나 폴더를 추가 |
| RUN        | 이미지를 빌드할 때 실행할 명령어를 지정                              |

## Dockerfile 명령어

### FROM

생성할 이미지의 베이스가 될 이미지를 뜻한다. FROM 명령어는 Dockderfile을 작성할 때 반드시 한 번 이상 입력해야 한다. 이미지 이름의 포맷은 docker run 명령어에서 이미지 이름을 사용했을 때와 같다. 사용하려는 이미지가 도커에 없다면 자동으로 pull 한다.

### MAINTAINER

이미지를 생성한 개발자의 정보를 나타낸다. 일반적으로 Dockefile을 작성한 사람과 연락할 수 있는 메일 등을 입력한다. 단, MAINTAINER는 도커 1.13.0 버전 이후로 사용하지 않는다. 대신 아래와 같은 LABEL로 교체해 표현할 수 있다.

`LABEL maintainer "alicek106 <alicek106@naver.com>"`

### LABEL

이미지에 메타데이터를 추가한다. 메타데이터는 '키:값'의 형태로 저장되며, 여러 개의 메타데이터가 저장될 수 있다. 추가된 메다데이터는 docker inspect 명령어로 이미지의 정보를 구해서 확인할 수 있다.

### RUN

이미지를 만들기 위해 컨테이너 내부에서 명령어를 실행한다. 주의할 사항으로, 이미지를 빌드할 때 별도의 입력을 받아야 하는 RUN이 있다면 build 명령어는 이를 오류로 간주하고 빌드를 종료한다.

RUN 명령어에 `["/bin/bash", "echo hello >> test2.html"]`과 같이 입력하면 /bin/bash 셸을 이용해 `echo hello >> test2.html`을 실행한다. Dockerfile의 일부 명령어는 이저철 배열의 형태로 사용할 수 있다. RUN의 경우에는 다음과 같은 형태로 사용된다.

`RUN ["실행 가능한 파일", "명령줄 인자 1", "명령줄 인자 2, ... ]`

이는 JSON 배열의 입력 형식을 따르기 때문에 JSON 형식과 일치해야 한다. 단, JSON 배열 형태로 Dockerfile의 명령어를 사용하면 셸을 실행하지 않는다. 예를 들어, `["echo", "$MY_ENV"]`는 `$MY_ENV` 환경변수를 사용하지 않는다. 이 형태로 셸을 사용하려면  `["sh", "-c", "echo $MY_ENV]`와 같이 사용하는 것이 좋다.

### ADD

파일을 이미지에 추가한다. 추가하는 파일은 Dockerfile이 위치한 디렉터리인 컨텍스트(Context)에서 가져온다.

ADD 명령어는 JSON 배열의 형태로 `"추가할 `

---

참고자료

#참고도서/그림과_실습으로_배우는_도커_쿠버네티스 
#참고도서/시작하세요_도커_쿠버네티스

---